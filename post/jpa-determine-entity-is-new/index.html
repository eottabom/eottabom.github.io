<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Eottabom&#x27;s Lab. - 어느 따뜻한 봄날이 나에게도 오겠지... 공부하는 개발자 기술 블로그</title><meta name="next-head-count" content="3"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" crossorigin="anonymous"></script><link rel="preload" href="/_next/static/css/9c45519b8bcf267a.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/9c45519b8bcf267a.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-9812adf83da216f2.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-03cd576e71e4cd66.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-b3e5bad5ec63c840.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-488ad85de98997d1.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/609-3bdadfe3937533de.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/post/%5Bid%5D-ba3a3f1cb3c7de2d.js" defer="" crossorigin=""></script><script src="/_next/static/vWO9_PUF1KWOJwAW0jvwg/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/vWO9_PUF1KWOJwAW0jvwg/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="fixed top-0 left-0 w-full h-1 z-50 bg-transparent"><div class="h-full bg-gradient-to-r from-black via-blue-500 to-teal-400 transition-all duration-150" style="width:0%"></div></div><header class="flex justify-end items-center px-6 py-4"><div class="flex gap-6 items-center"><a class="text-black hover:text-blue-300" href="/"><span class="font-bold">Main</span></a><a class="text-black hover:text-blue-300 font-bold" href="/post/">Post</a><a class="text-black hover:text-blue-300 font-bold" href="/about/">About</a></div></header><div class="max-w-[90rem] mx-auto px-6 py-20 flex gap-16"><main class="flex-1 max-w-3xl prose prose-xl mr-[17rem]"><h1 class="text-4xl font-bold mb-4">Spring Data JPA - 새로운 Entity 판별</h1><p class="text-gray-500 text-sm mb-8">2025-04-30</p><article><div class="my-4 px-4 py-3 rounded-md prose bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-400 text-blue-900 dark:text-blue-100"><div class="text-mi flex items-center gap-2 mt-2 mb-2 text-blue-700 dark:text-blue-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-blue-700 dark:text-blue-300"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>Spring Data JPA 를 사용하다보면 save() 메서드 호출 시 내부적으로 persist() 를 호출할지, merge() 를 호출 할 지 결정하게 된다. 해당 Entity 가 새로운 Entity 인지 여부에 따라 결정되는데, Spring Data JPA 는 Entity 가 새로운지 어떻게 판단하는지 알아보자.</div><div class="space-y-1 text-mi pl-[1.3rem] text-blue-700 dark:text-blue-300"></div></div>
<hr/>
<h3 id="신규-entity-판단-방식"><a aria-hidden="true" tabindex="-1" href="#신규-entity-판단-방식"><span class="icon icon-link"></span></a>신규 Entity 판단 방식</h3>
<p>Spring Data JPA 는 내부적으로 <code>JpaEntityInformation</code> 의 <code>isNew(T entity)</code> 메서드를 호출해서 판단한다.</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line"><span class="token annotation punctuation">@Override</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isNew</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>versionAttribute<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token operator">||</span> versionAttribute<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Attribute</span><span class="token operator">::</span><span class="token function">getJavaType</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token operator">::</span><span class="token function">isPrimitive</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">isNew</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token class-name">BeanWrapper</span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectFieldAccessFallbackBeanWrapper</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> versionAttribute<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>it <span class="token operator">-&gt;</span> wrapper<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<ul>
<li><code>@Version</code> 필드가 있다면 → 해당 버전 필드 값이 null 인지 여부로 판단</li>
<li><code>@Version</code> 필드가 없다면 → <code>@Id</code> 필드가 null 이거나, primitive 타입일 경우, 0인지 여부로 판단</li>
</ul>
<div class="my-4 px-4 py-3 rounded-md prose bg-purple-50 dark:bg-purple-900/30 border-l-4 border-purple-400 text-purple-900 dark:text-purple-100"><div class="text-mi flex items-center gap-2 mt-2 mb-2 text-purple-700 dark:text-purple-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-purple-700 dark:text-purple-300"><path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"></path><path d="m9 12 2 2 4-4"></path></svg>즉, ID 가 null 이면 신규 Entity 로 간주 하여 persist() 가 호출된다.</div><div class="space-y-1 text-mi pl-[1.3rem] text-purple-700 dark:text-purple-300"></div></div>
<hr/>
<h3 id="직접-id-를-지정한-경우의-동작"><a aria-hidden="true" tabindex="-1" href="#직접-id-를-지정한-경우의-동작"><span class="icon icon-link"></span></a>직접 ID 를 지정한 경우의 동작</h3>
<p>ID를 직접 지정하고 <code>save()</code> 를 호출하면, JPA 는 해당 Entity 가 기존에 존재한다고 판단하여 merge()를 수행한다. <br/>
이때 실제 Database 에 해당 ID가 존재하지 않으면, <span class="text-blue-600 font-bold"> SELECT 쿼리는 0건을 반환하고 </span> <br/>
JPA 는 병합용 엔티티를 새로 생성하여 INSERT 를 시도하거나, 제약 조건 위반으로 예외가 발생할 수 있다. <br/>
<span class="text-red-600 font-bold"> 결국, 신규 Entity 임에도 JPA 는 기존 데이터처럼 인식하게 되어, 의도치 않은 UPDATE 또는 INSERT 실패로 이어질 수 있다 </span></p>
<div class="my-4 px-4 py-3 rounded-md prose bg-purple-50 dark:bg-purple-900/30 border-l-4 border-purple-400 text-purple-900 dark:text-purple-100"><div class="text-mi flex items-center gap-2 mt-2 mb-2 text-purple-700 dark:text-purple-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-purple-700 dark:text-purple-300"><path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"></path><path d="m9 12 2 2 4-4"></path></svg>merge 는 UPDATE 뿐만 아니라, INSERT 도 가능하지만, 직접 ID 가 지정된 신규 엔티티에는 매우 위험하다.</div><div class="space-y-1 text-mi pl-[1.3rem] text-purple-700 dark:text-purple-300"></div></div>
<p>이를 해결 하기 위한 방법으로는 <code>Persistable&lt;T&gt;</code> 인터페이스를 구현하면 된다.</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line"><span class="token comment">// User.class</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token annotation punctuation">@Entity</span>
</span><span class="code-line"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token annotation punctuation">@EntityListeners</span><span class="token punctuation">(</span><span class="token class-name">UserEntityListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Persistable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token annotation punctuation">@Id</span>
</span><span class="code-line">	<span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">private</span> <span class="token keyword">boolean</span> isNew <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">protected</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
</span><span class="code-line">		<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token annotation punctuation">@Override</span>
</span><span class="code-line">	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token annotation punctuation">@Override</span>
</span><span class="code-line">	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isNew<span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIsNew</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isNew<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">this</span><span class="token punctuation">.</span>isNew <span class="token operator">=</span> isNew<span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// UserEntityListener.class</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserEntityListener</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token annotation punctuation">@PostPersist</span>
</span><span class="code-line">	<span class="token annotation punctuation">@PostLoad</span>
</span><span class="code-line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNotNew</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@PostPersist/@PostLoad called&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">		user<span class="token punctuation">.</span><span class="token function">setIsNew</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<hr/>
<h3 id="persist-vs-merge"><a aria-hidden="true" tabindex="-1" href="#persist-vs-merge"><span class="icon icon-link"></span></a>persist() vs merge()</h3>
<table><thead><tr><th>구분</th><th>persist()</th><th>merge()</th></tr></thead><tbody><tr><td>동작</td><td>새로운 Entity 를 영속성 컨텍스트에 등록</td><td>준영속 객체를 병합하여 관리</td></tr><tr><td>SELECT 쿼리</td><td>❌</td><td>✅ 먼저 조회 후 merge</td></tr><tr><td>ID 필요 여부</td><td>❌</td><td>✅</td></tr><tr><td>성능</td><td>빠름 (직접 INSERT)</td><td>느릴수 있다 (SELECT + UPDATE)</td></tr></tbody></table>
<div class="my-4 px-4 py-3 rounded-md prose bg-purple-50 dark:bg-purple-900/30 border-l-4 border-purple-400 text-purple-900 dark:text-purple-100"><div class="text-mi flex items-center gap-2 mt-2 mb-2 text-purple-700 dark:text-purple-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-purple-700 dark:text-purple-300"><path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"></path><path d="m9 12 2 2 4-4"></path></svg>신규 객체를 merge() 로 처리하면 불필요한 SELECT 쿼리가 발생하고 성능 저하 가능성이 존재하게 된다.</div><div class="space-y-1 text-mi pl-[1.3rem] text-purple-700 dark:text-purple-300"></div></div>
<hr/>
<h3 id="신규-entity-판단이-중요한-이유는-무엇일까"><a aria-hidden="true" tabindex="-1" href="#신규-entity-판단이-중요한-이유는-무엇일까"><span class="icon icon-link"></span></a>신규 Entity 판단이 중요한 이유는 무엇일까?</h3>
<p>Spring Data JPA 의 <code>SimpleJpaRepository</code> 는 <code>save()</code> 에서 다음과 같이 동작한다.</p>
<pre class="language-java"><code class="language-java code-highlight"><span class="code-line"><span class="token annotation punctuation">@Transactional</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>entityInformation<span class="token punctuation">.</span><span class="token function">isNew</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// INSERT</span>
</span><span class="code-line">        <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> entityManager<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SELECT → UPDATE, 존재하면 UPDATE 없으면 INSERT 가능성 있음</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>ID 를 직접 설정했지만, <code>isNew()</code> 는 false 가 되어, <code>merge()</code> 를 호출하게 되고, <br/>
Database 에는 해당 ID 가 존재하지 않지만, 신규 Entity 임에도 불구하고, <code>SELECT</code> 후 <code>UPDATE</code> 를 하게 되어 (이 때, database 조회) 실패 또는 데이터 무결성 오류가 발생할 수 있고, 비효율적이다.</p>
<div class="my-4 px-4 py-3 rounded-md prose bg-purple-50 dark:bg-purple-900/30 border-l-4 border-purple-400 text-purple-900 dark:text-purple-100"><div class="text-mi flex items-center gap-2 mt-2 mb-2 text-purple-700 dark:text-purple-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-purple-700 dark:text-purple-300"><path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"></path><path d="m9 12 2 2 4-4"></path></svg>정확한 isNew() 제어는 성능, 정합성, 쿼리 효율성 측면에서 매우 중요하다.</div><div class="space-y-1 text-mi pl-[1.3rem] text-purple-700 dark:text-purple-300"></div></div>
<hr/>
<h3 id="요약"><a aria-hidden="true" tabindex="-1" href="#요약"><span class="icon icon-link"></span></a>요약</h3>
<table><thead><tr><th>상황</th><th>처리방식</th></tr></thead><tbody><tr><td>ID 없거나 null → 신규 Entity</td><td>persist()</td></tr><tr><td>ID가 존재하지만 실제 DB 에는 없음</td><td>merge() 호출 → 실패 가능성 / 비효율</td></tr><tr><td>ID 를 직접 설정한 신규 Entity</td><td>Persistable&lt;T&gt; + isNew() 로 명시 필요</td></tr></tbody></table>
<div class="my-4 px-4 py-3 rounded-md prose bg-cyan-50 dark:bg-cyan-900/30 border-l-4 border-cyan-400 text-cyan-900 dark:text-cyan-100"><div class="text-mi flex items-center gap-2 mt-2 mb-2 text-cyan-700 dark:text-cyan-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-cyan-700 dark:text-cyan-300"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>예제 코드 보러가기 (클릭)</div><div class="space-y-1 text-mi pl-[1.3rem] text-cyan-700 dark:text-cyan-300"></div></div>
<br/>
<br/>
<div class="my-4 px-4 py-3 rounded-md prose bg-green-50 dark:bg-green-900/30 border-l-4 border-green-400 text-green-900 dark:text-green-100"><div class="text-mi flex items-center gap-2 mt-2 mb-2 text-green-700 dark:text-green-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-green-700 dark:text-green-300"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>💡 정리 Spring Data JPA 는 내부적으로 isNew() 를 통해서 신규 Entity 여부를 판단한다. ID 는 존재하지만 실제 DB 에 없는 경우 SELECT + UPDATE 후 merge 를 하므로 정합성이 떨어질 수 있고, 비효율적이다. ID 를 직접 설정했을 경우는 Persistable + isNew() 로 명시하는 것이 필요하다.</div><div class="space-y-1 text-mi pl-[1.3rem] text-green-700 dark:text-green-300"></div></div>
<hr/>
<h3 id="-reference"><a aria-hidden="true" tabindex="-1" href="#-reference"><span class="icon icon-link"></span></a>📚 Reference</h3>
<ul>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/support/JpaEntityInformation.html">Spring Docs - JpaEntityInformation</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/reference/jpa/entity-persistence.html">Spring Docs - entity-persistence</a></li>
</ul>
<br/>
<br/></article></main><aside class="hidden lg:block fixed right-10 top-[96px] w-60 h-[calc(100vh-96px)] pl-4 z-40 pb-[120px]"><div class="relative h-full"><div class="overflow-y-auto h-full pr-2 scrollbar-hide"><h2 class="text-sm font-semibold mb-2">🧾 목차</h2><ul class="space-y-1 text-xs sm:text-sm text-gray-700 pb-12"></ul></div></div></aside></div><a class="fixed bottom-6 right-6 z-50 bg-white border border-gray-300 rounded-lg shadow-md p-3 hover:shadow-lg transition" aria-label="목록으로 가기" href="/post/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-gray-800"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg></a></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"id":"jpa-determine-entity-is-new","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    info: \"info\",\n    p: \"p\",\n    hr: \"hr\",\n    h3: \"h3\",\n    a: \"a\",\n    span: \"span\",\n    code: \"code\",\n    pre: \"pre\",\n    ul: \"ul\",\n    li: \"li\",\n    note: \"note\",\n    strong: \"strong\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    tip: \"tip\",\n    success: \"success\"\n  }, _provideComponents(), props.components), {BlueText, RedText} = _components;\n  if (!BlueText) _missingMdxReference(\"BlueText\", true);\n  if (!RedText) _missingMdxReference(\"RedText\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.info, {\n      children: _jsxs(_components.p, {\n        children: [\"Spring Data JPA 를 사용하다보면 save() 메서드 호출 시 내부적으로 persist() 를 호출할지, merge() 를 호출 할 지 결정하게 된다. \", _jsx(\"br\", {}), \"\\n해당 Entity 가 새로운 Entity 인지 여부에 따라 결정되는데, Spring Data JPA 는 Entity 가 새로운지 어떻게 판단하는지 알아보자.\"]\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.h3, {\n      id: \"신규-entity-판단-방식\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#신규-entity-판단-방식\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"신규 Entity 판단 방식\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Spring Data JPA 는 내부적으로 \", _jsx(_components.code, {\n        children: \"JpaEntityInformation\"\n      }), \" 의 \", _jsx(_components.code, {\n        children: \"isNew(T entity)\"\n      }), \" 메서드를 호출해서 판단한다.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-java\",\n      children: _jsxs(_components.code, {\n        className: \"language-java code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@Override\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"boolean\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"isNew\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"T\"\n          }), \" entity\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"versionAttribute\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"isEmpty\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"||\"\n          }), \" versionAttribute\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"map\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Attribute\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"::\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getJavaType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"map\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Class\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"::\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"isPrimitive\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"orElse\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"super\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"isNew\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"entity\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"BeanWrapper\"\n          }), \" wrapper \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"DirectFieldAccessFallbackBeanWrapper\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"entity\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" versionAttribute\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"map\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"it \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"-\u003e\"\n          }), \" wrapper\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getPropertyValue\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"it\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getName\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"==\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"null\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"orElse\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"@Version\"\n        }), \" 필드가 있다면 → 해당 버전 필드 값이 null 인지 여부로 판단\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"@Version\"\n        }), \" 필드가 없다면 → \", _jsx(_components.code, {\n          children: \"@Id\"\n        }), \" 필드가 null 이거나, primitive 타입일 경우, 0인지 여부로 판단\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.note, {\n      children: _jsxs(_components.p, {\n        children: [\"즉, ID 가 null 이면 \", _jsx(_components.strong, {\n          children: \"신규 Entity 로 간주\"\n        }), \"하여 \", _jsx(_components.strong, {\n          children: \"persist()\"\n        }), \" 가 호출된다.\"]\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.h3, {\n      id: \"직접-id-를-지정한-경우의-동작\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#직접-id-를-지정한-경우의-동작\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"직접 ID 를 지정한 경우의 동작\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ID를 직접 지정하고 \", _jsx(_components.code, {\n        children: \"save()\"\n      }), \" 를 호출하면, JPA 는 해당 Entity 가 기존에 존재한다고 판단하여 merge()를 수행한다. \", _jsx(\"br\", {}), \"\\n이때 실제 Database 에 해당 ID가 존재하지 않으면, \", _jsx(BlueText, {\n        children: \" SELECT 쿼리는 0건을 반환하고 \"\n      }), \" \", _jsx(\"br\", {}), \"\\nJPA 는 병합용 엔티티를 새로 생성하여 INSERT 를 시도하거나, 제약 조건 위반으로 예외가 발생할 수 있다. \", _jsx(\"br\", {}), \"\\n\", _jsx(RedText, {\n        children: \" 결국, 신규 Entity 임에도 JPA 는 기존 데이터처럼 인식하게 되어, 의도치 않은 UPDATE 또는 INSERT 실패로 이어질 수 있다 \"\n      })]\n    }), \"\\n\", _jsx(_components.note, {\n      children: _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"merge\"\n        }), \" 는 \", _jsx(_components.strong, {\n          children: \"UPDATE\"\n        }), \" 뿐만 아니라, \", _jsx(_components.strong, {\n          children: \"INSERT\"\n        }), \" 도 가능하지만, \", _jsx(\"br\", {}), \"\\n직접 ID 가 지정된 신규 엔티티에는 매우 위험하다.\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"이를 해결 하기 위한 방법으로는 \", _jsx(_components.code, {\n        children: \"Persistable\u003cT\u003e\"\n      }), \" 인터페이스를 구현하면 된다.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-java\",\n      children: _jsxs(_components.code, {\n        className: \"language-java code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// User.class\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@Entity\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@Table\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"name \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"users\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@EntityListeners\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"UserEntityListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"class\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"class\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"User\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"implements\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Persistable\"\n          }), _jsxs(_components.span, {\n            className: \"token generics\",\n            children: [_jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003c\"\n            }), _jsx(_components.span, {\n              className: \"token class-name\",\n              children: \"String\"\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@Id\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"String\"\n          }), \" id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"String\"\n          }), \" name\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"boolean\"\n          }), \" isNew \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"protected\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"User\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"User\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"String\"\n          }), \" id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"String\"\n          }), \" name\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"id \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"name \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" name\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@Override\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"String\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getId\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"setId\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"String\"\n          }), \" id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"id \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"String\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getName\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"name\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@Override\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"boolean\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"isNew\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"isNew\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"setIsNew\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"boolean\"\n          }), \" isNew\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"isNew \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" isNew\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// UserEntityListener.class\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"class\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"UserEntityListener\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@PostPersist\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@PostLoad\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"setNotNew\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"User\"\n          }), \" user\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\t\", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"System\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"out\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"println\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"@PostPersist/@PostLoad called\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\\tuser\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"setIsNew\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"\\t\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.h3, {\n      id: \"persist-vs-merge\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#persist-vs-merge\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"persist() vs merge()\"]\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"구분\"\n          }), _jsx(_components.th, {\n            children: \"persist()\"\n          }), _jsx(_components.th, {\n            children: \"merge()\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"동작\"\n          }), _jsx(_components.td, {\n            children: \"새로운 Entity 를 영속성 컨텍스트에 등록\"\n          }), _jsx(_components.td, {\n            children: \"준영속 객체를 병합하여 관리\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"SELECT 쿼리\"\n          }), _jsx(_components.td, {\n            children: \"❌\"\n          }), _jsx(_components.td, {\n            children: \"✅ 먼저 조회 후 merge\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"ID 필요 여부\"\n          }), _jsx(_components.td, {\n            children: \"❌\"\n          }), _jsx(_components.td, {\n            children: \"✅\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"성능\"\n          }), _jsx(_components.td, {\n            children: \"빠름 (직접 INSERT)\"\n          }), _jsx(_components.td, {\n            children: \"느릴수 있다 (SELECT + UPDATE)\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.note, {\n      children: _jsx(_components.p, {\n        children: \"신규 객체를 merge() 로 처리하면 불필요한 SELECT 쿼리가 발생하고 성능 저하 가능성이 존재하게 된다.\"\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.h3, {\n      id: \"신규-entity-판단이-중요한-이유는-무엇일까\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#신규-entity-판단이-중요한-이유는-무엇일까\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"신규 Entity 판단이 중요한 이유는 무엇일까?\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Spring Data JPA 의 \", _jsx(_components.code, {\n        children: \"SimpleJpaRepository\"\n      }), \" 는 \", _jsx(_components.code, {\n        children: \"save()\"\n      }), \" 에서 다음과 같이 동작한다.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-java\",\n      children: _jsxs(_components.code, {\n        className: \"language-java code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token annotation punctuation\",\n            children: \"@Transactional\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"public\"\n          }), \" \", _jsxs(_components.span, {\n            className: \"token generics\",\n            children: [_jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003c\"\n            }), _jsx(_components.span, {\n              className: \"token class-name\",\n              children: \"S\"\n            }), \" \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"extends\"\n            }), \" \", _jsx(_components.span, {\n              className: \"token class-name\",\n              children: \"T\"\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"S\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"save\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"S\"\n          }), \" entity\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"entityInformation\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"isNew\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"entity\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        entityManager\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"persist\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"entity\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// INSERT\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" entity\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" entityManager\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"merge\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"entity\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// SELECT → UPDATE, 존재하면 UPDATE 없으면 INSERT 가능성 있음\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"ID 를 직접 설정했지만, \", _jsx(_components.code, {\n        children: \"isNew()\"\n      }), \" 는 false 가 되어, \", _jsx(_components.code, {\n        children: \"merge()\"\n      }), \" 를 호출하게 되고, \", _jsx(\"br\", {}), \"\\nDatabase 에는 해당 ID 가 존재하지 않지만, 신규 Entity 임에도 불구하고, \", _jsx(_components.code, {\n        children: \"SELECT\"\n      }), \" 후 \", _jsx(_components.code, {\n        children: \"UPDATE\"\n      }), \" 를 하게 되어 (이 때, database 조회) 실패 또는 데이터 무결성 오류가 발생할 수 있고, 비효율적이다.\"]\n    }), \"\\n\", _jsx(_components.note, {\n      children: _jsx(_components.p, {\n        children: \"정확한 isNew() 제어는 성능, 정합성, 쿼리 효율성 측면에서 매우 중요하다.\"\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.h3, {\n      id: \"요약\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#요약\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"요약\"]\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"상황\"\n          }), _jsx(_components.th, {\n            children: \"처리방식\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"ID 없거나 null → 신규 Entity\"\n          }), _jsx(_components.td, {\n            children: \"persist()\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"ID가 존재하지만 실제 DB 에는 없음\"\n          }), _jsx(_components.td, {\n            children: \"merge() 호출 → 실패 가능성 / 비효율\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"ID 를 직접 설정한 신규 Entity\"\n          }), _jsx(_components.td, {\n            children: \"Persistable\u003cT\u003e + isNew() 로 명시 필요\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.tip, {\n      children: _jsx(\"a\", {\n        href: \"https://github.com/eottabom/let-me-code/tree/main/src/main/java/com/eottabom/letmecode/example/_01_jpa_entity\",\n        children: \"예제 코드 보러가기 (클릭)\"\n      })\n    }), \"\\n\", _jsx(\"br\", {}), \"\\n\", _jsx(\"br\", {}), \"\\n\", _jsx(_components.success, {\n      children: _jsxs(_components.p, {\n        children: [\"💡 \", _jsx(\"b\", {\n          children: \"정리\"\n        }), _jsx(\"br\", {}), \"\\nSpring Data JPA 는 내부적으로 isNew() 를 통해서 신규 Entity 여부를 판단한다. \", _jsx(\"br\", {}), \"\\nID 는 존재하지만 실제 DB 에 없는 경우 SELECT + UPDATE 후 merge 를 하므로 정합성이 떨어질 수 있고, 비효율적이다. \", _jsx(\"br\", {}), \"\\nID 를 직접 설정했을 경우는 Persistable + isNew() 로 명시하는 것이 필요하다. \", _jsx(\"br\", {})]\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.h3, {\n      id: \"-reference\",\n      children: [_jsx(_components.a, {\n        \"aria-hidden\": \"true\",\n        tabIndex: \"-1\",\n        href: \"#-reference\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"📚 Reference\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/support/JpaEntityInformation.html\",\n          children: \"Spring Docs - JpaEntityInformation\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://docs.spring.io/spring-data/jpa/reference/jpa/entity-persistence.html\",\n          children: \"Spring Docs - entity-persistence\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"br\", {}), \"\\n\", _jsx(\"br\", {})]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{"title":"Spring Data JPA - 새로운 Entity 판별","date":"2025-04-30","tags":["Spring","JPA"],"summary":"How does Spring Data JPA Determine if an Entity is New?","description":"Spring Data JPA 에서 Entity 가 새로운 것인지 판단하는 방법에 대해서 알아보자."}},"title":"Spring Data JPA - 새로운 Entity 판별","date":"2025-04-30","tags":["Spring","JPA"],"summary":"How does Spring Data JPA Determine if an Entity is New?","description":"Spring Data JPA 에서 Entity 가 새로운 것인지 판단하는 방법에 대해서 알아보자."}},"__N_SSG":true},"page":"/post/[id]","query":{"id":"jpa-determine-entity-is-new"},"buildId":"vWO9_PUF1KWOJwAW0jvwg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>