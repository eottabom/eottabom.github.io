---
title: "ë¹ ë¥´ê²Œ ì´í•´í•˜ëŠ” Envoy ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°"
date: "2025-10-21"
tags: ["Envoy"]
summary: "A quick and practical overview of Envoy's core architecture."
description: "Envoy ì˜ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°ì™€ íŠ¸ë˜í”½ ì²˜ë¦¬ íë¦„, ë¡œë“œë°¸ëŸ°ì‹±, Connection ê´€ë¦¬, xDS ì— ëŒ€í•´ì„œ ë¹ ë¥´ê²Œ ì•Œì•„ë³´ì."
---

:::info
envoy ëŠ” service-mesh ë¥¼ êµ¬ì„±í•  ë•Œ í•µì‹¬ì ì¸ ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” í”„ë¡ì‹œì´ë‹¤.
downstream/upstream ê°œë…ì„ ê¸°ë°˜ìœ¼ë¡œ Listener, Route, Cluster, Endpoint ë¥¼ í†µí•´ íŠ¸ë˜í”½ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì œì–´í•œë‹¤.
envoy ì˜ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°ì™€ íŠ¸ë˜í”½ ì²˜ë¦¬ íë¦„(Listener -> filter chain -> Router Filter -> Cluster),
ë¡œë“œë°¸ëŸ°ì‹± ë° Connection ê´€ë¦¬, xDS ë¥¼ í†µí•œ ë™ì  ì„¤ì • ë°©ì‹ê¹Œì§€ ë¹ ë¥´ê²Œ ì´í•´í•´ë³´ì.
:::

<Tabs>
    <Tab label="Basic">
        <div style={{ textAlign: 'center' }}>
            <img src="/img/post/envoy/envoy.png" alt="envoy"  style={{ display: 'inline-block' }} />
        </div>
        * <b>Downstream</b>
          * Envoy ì—ê²Œ ìš”ì²­ì„ ë³´ë‚´ëŠ” í˜¸ìŠ¤íŠ¸
        * <b>Upstream</b>
          * Envoy ê°€ ìš”ì²­ì„ ë³´ë‚´ëŠ” í˜¸ìŠ¤íŠ¸
        * <b>Listener</b>
          * ì–´ë–¤ IP, Port ë¥¼ ì²˜ë¦¬ í•  ì§€ ì •ì˜í•œë‹¤. (=downstream ìœ¼ë¡œë¶€í„° ìš”ì²­ì„ ë°›ëŠ” ë¶€ë¶„)
        * <b>Route</b>
          * Listener ë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ ì–´ë””ë¡œ ë³´ë‚¼ì§€ ì •ì˜í•œë‹¤ (routing ëŒ€ìƒì€ Cluster)
        * <b>Cluster</b>
          * ì‹¤ì œ ìš”ì²­ì´ ì²˜ë¦¬ë˜ëŠ” IP ë˜ëŠ” Endpoint ë“¤ì´ë‹¤. (=upstream ë“¤)
        * <b>Endpoint</b>
          * ì‹¤ì œë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ Endpoint (ì—¬ëŸ¬ endpoint ê°€ ëª¨ì—¬ì„œ cluster ê°€ ëœë‹¤)
    </Tab>
    <Tab label="Listener">
        :::success
        Listener ëŠ”? ì–´ë–¤ IP, Port ë¥¼ ì²˜ë¦¬ í•  ì§€ ì •ì˜í•œë‹¤. (=downstream ìœ¼ë¡œ ë¶€í„° ìš”ì²­ ë°›ì€ ë¶€ë¶„)
        :::
        * Listener ë¥¼ í†µí•´ì„œ íŠ¸ë˜í”½ì´ ì „ë‹¬ë˜ë©´, Cluster ë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ ì—¬ëŸ¬ ê³¼ì •ì„ ê±°ì¹˜ê²Œ ëœë‹¤.
        * Listener ëŠ” Listener Filters ì™€ Filter Chains <GreenText>(Network Filter)</GreenText> ë¥¼ ì§€ë‹ˆê³  ìˆë‹¤.
        * Listener filters = Connection ì— ëŒ€í•œ Metadata ë¥¼ ì¡°ì‘í•˜ê±°ë‚˜ ì¶”ê°€í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.
        * Filters Chains = ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.
        * Filters Chains ì´ L3/L4 Filter ê¸°ëŠ¥ì„ ë‹´ë‹¹í•œë‹¤.
        <div style={{ textAlign: 'center' }}>
            <img src="/img/post/envoy/listener.png" alt="listener"  style={{ display: 'inline-block' }} />
        </div>
    </Tab>
    <Tab label="HTTP Connection manager">
        * HTTP ë¥¼ ë‹´ë‹¹í•˜ëŠ” Network Level ì˜ Filter ë¡œ Filter Chain ì˜ ê°€ì¥ ë§ˆì§€ë§‰ì— ìœ„ì¹˜í•œë‹¤.
        * ì£¼ìš” ê¸°ëŠ¥ì€ raw byte ë¥¼ HTTP ë©”ì‹œì§€ë¡œ Convert ë¥¼ ë‹´ë‹¹í•˜ê³ ,
          * HTTP Header ì¡°ì‘, Retry ì„¤ì •, Redirect, Timeout
        * ë‚´ë¶€ì ìœ¼ë¡œ HTTP L7 Filter ë“¤ì´ ì¡´ì¬í•˜ì—¬ ë¶€ê°€ì ì¸ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
    </Tab>
    <Tab label="Cluster">
        :::success
        Cluster ëŠ”? ì‹¤ì œ ìš”ì²­ì´ ì²˜ë¦¬ë˜ëŠ” IP ë˜ëŠ” Endpoint ë“¤ì´ë‹¤. (=upstream ë“¤)
        Endpoint ëŠ”? ì‹¤ì œë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ Endpoint
        :::
        <BlueText>Cluster - Load Balancing</BlueText> <br/>
        * Cluster ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ì„œ Endpoint ë¥¼ ê·¸ë£¹í•‘í•´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆê³ ,
        * Endpoint ì¤‘ì—ì„œ ì–´ë””ë¡œ íŠ¸ë˜í”½ì„ ë³´ë‚¼ì§€ ê²°ì •í•˜ëŠ” <b>Load Balancing</b> ì„ ê²°ì •í•  ìˆ˜ ìˆë‹¤.
        <div style={{ textAlign: 'center' }}>
            <img src="/img/post/envoy/cluster.png" alt="cluster"  style={{ display: 'inline-block' }} />
        </div>

        ```yaml
        clusters:
        - name: some_service
          connection_timeout: 0.25s
          type: STATIC
          lb_policy: ROUND_ROBIN
          load_assignment:
            cluster_name: some_service
            endpoints:
            - lb_endpoints:
              - endpoint:
                address:
                  socket_address:
                    address: 127.0.0.1
                    port_value: 1234
        ```
        :::note
        <b>Service Discovery Type</b>
        - upstream cluster ê°€ ì •ì˜ ë˜ë©´ Envoy ê°€ Cluster êµ¬ì„±ì›ì„ í™•ì¸í•˜ëŠ” ë°©ë²•
        1) STATIC
        - ê°€ì¥ ê°„ë‹¨í•œ ìœ í˜• (ê¸°ë³¸ê°’)
        2) STRICT_DNS
        - DNS ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ì—„ê²©í•˜ê²Œ ì·¨í•˜ì—¬ ì „ì²´ upstream cluster ë¥¼ êµ¬ì„±
        3) LOGICAL_DNS
        - ë¹„ë™ê¸° í™•ì¸ ë©”ì»¤ë‹ˆì¦˜ì´ë‚˜, ì²«ë²ˆì§¸ IP ì£¼ì†Œë§Œ ì‚¬ìš©
        4) EDS
        - xDS ê´€ë¦¬ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ë‹¤.
        5) ORIGINAL_DST
        - ì›ë˜ ëª©ì ì§€
        :::

        <BlueText>Cluster - Connection Pool</BlueText> <br/>
        * Cluster ëŠ” Connection Pool ê´€ë¦¬ ê¸°ëŠ¥ë„ ìˆ˜í–‰í•œë‹¤.

        :::warning
        <b>common_http_protocol_option</b>ì˜ idle_timeout ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ 1ì‹œê°„ì´ë‹¤.
        ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ, application ì—ì„œ ë¨¼ì € ì—°ê²°ì„ ëŠì„ ê²½ìš°,
        upstream connect error or disconnect/reset before headers. reset reason: connection termination ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
        :::

        ```yaml
        "connect_timeout": "5s", ### Tomcat / Netty connection timeout ë³´ë‹¤ ì‘ê²Œ ì„¤ì •í•œë‹¤. (ê¸°ë³¸ ê°’ 5ì´ˆ)
        "typed_extension_protocol_options": {
            "envoy.extension_protocol_options": {
                "@type":"type.googleapis.com/envoy.extensions.upostreams.http.v3.HttpProtocolOptions",
                "common_http_protocol_options": {
                    "idle_timeout":"60s"
                    ### Tomcat / Netty idle timeout ì„¤ì •ë³´ë‹¤ ì‘ê²Œ ì„¤ì •í•œë‹¤.
                    ### ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ ê°’ì€ 1ì‹œê°„ì´ê³ ,
                    ### 0 ìœ¼ë¡œ ë¹„í™œì„±í™”ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ, TCP FIN íŒ¨í‚· ì†ì‹¤ë“±ìœ¼ë¡œ ì¸í•œ ì—°ê²° ëˆ„ì¶œì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
                },
                "explicit_http_config": {
                    ### ì—¬ê¸°ì„œ http_protocol_options ë‚˜ http2_protocol_options ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
                }
            }
        }
        ```
    </Tab>
    <Tab label="Flow">
        :::success
        Downstream ì€? Envoy ì—ê²Œ ìš”ì²­ì„ ë³´ë‚´ëŠ” í˜¸ìŠ¤íŠ¸
        Upstream ì€? Envoy ê°€ ìš”ì²­ì„ ë³´ë‚´ëŠ” í˜¸ìŠ¤íŠ¸
        Listener ëŠ”? ì–´ë–¤ IP, Port ë¥¼ ì²˜ë¦¬ í•  ì§€ ì •ì˜í•œë‹¤. (=downstream ìœ¼ë¡œ ë¶€í„° ìš”ì²­ ë°›ì€ ë¶€ë¶„)
        Route ëŠ”? Listener ë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ ì–´ë””ë¡œ ë³´ë‚¼ì§€ ì •ì˜í•œë‹¤ (routing ëŒ€ìƒì€ Cluster)
        Cluster ëŠ”? ì‹¤ì œ ìš”ì²­ì´ ì²˜ë¦¬ë˜ëŠ” IP ë˜ëŠ” Endpoint ë“¤ì´ë‹¤. (=upstream ë“¤)
        Endpoint ëŠ”? ì‹¤ì œë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ Endpoint (ì—¬ëŸ¬ endpoint ê°€ ëª¨ì—¬ì„œ cluster ê°€ ëœë‹¤)
        :::

        HTTP ìš”ì²­ì— ëŒ€í•œ ë‚´ë¶€ íë¦„ì€, ì•„ë˜ì™€ ê°™ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.
        <div style={{ textAlign: 'center' }}>
            <img src="/img/post/envoy/flow.png" alt="flow"  style={{ display: 'inline-block' }} />
        </div>

        * ë‹¤ë¥¸ ë…¸ë“œë‚˜ Client ì—ì„œ <BlueText>(Downstream)</BlueText> Envoy ì—ê²Œ ìš”ì²­ì„ ë³´ë‚´ê³ ,
        * Envoy Listener ê°€ ìš”ì²­ì„ ë°›ì•„ì„œ <BlueText>(Downstream ìœ¼ë¡œ ë¶€í„° ìš”ì²­ì„ ë°›ìŒ)</BlueText>
        * Listener ë‚´ë¶€ì ìœ¼ë¡œ Listener Filtersë¡œ ì „ë‹¬í•˜ê³ , Filter Chainsë¥¼ ìˆœíšŒí•˜ë©´ì„œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ë° ì í•©í•œ Filterë¥¼ ì°¾ê³  í•´ë‹¹ Filter ê°€ ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤.
        * Router Filter ëŠ” ìš”ì²­ì— ì í•©í•œ Cluster ë¥¼ ì°¾ì•„ì„œ í•´ë‹¹ Cluster <BlueText>(Upstream í˜¸ìŠ¤íŠ¸ ì§‘ë‹¨)</BlueText> ì—ê²Œ íŠ¸ë˜í”½ì„ Forwarding í•œë‹¤.
        * Cluster ëŠ” ë‚´ë¶€ì— ì„¤ì •ëœ ë¡œë“œë°¸ë¦°ì‹± ì •ì±…ì„ ê³ ë ¤í•´ì„œ ì í•©í•œ Endpoint ë¥¼ ì„ ì •í•˜ê³ , ë§¤ì¹­ëœ ê³³ìœ¼ë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬í•œë‹¤. <BlueText>(To Upstream)</BlueText>
    </Tab>
    <Tab label="xDS">
        * Envoy ì»´í¬ë„ŒíŠ¸(Listener, Cluster, Filter...) ë“¤ì„ ë“±ë¡í•˜ëŠ” ë°©ì‹ì—ëŠ” Static, Dynamic ì´ ìˆë‹¤.
        * Static ì€ Envoy ê¸°ë™ ì‹œì ì— config íŒŒì¼ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ë“±ë¡í•˜ëŠ” ë°©ì‹
        * Dynamic ì€ Envoy ê°€ ê¸°ë™ ì¤‘ì¸ ìƒíƒœë¡œ config ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë°©ì‹
          * ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•´ì£¼ëŠ”ë°, ê·¸ê²Œ xDS API ì´ë‹¤.
        <div style={{ textAlign: 'center' }}>
            <img src="/img/post/envoy/xds.png" alt="xds"  style={{ display: 'inline-block' }} />
        </div>
    </Tab>
</Tabs>

---

### ğŸ“š Reference

- [Envoy-internals ì•„í‚¤í…ì³ Overview by ë¶ê·¹ í­ê·„](https://cla9.tistory.com/191)

<br/><br/>
